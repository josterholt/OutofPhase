<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style type="text/css">
        body {
            overflow:hidden;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.0/css/foundation.min.css" />
    <link rel="stylesheet" href="css/main.css" />

    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.0/js/foundation.min.js"></script>

    <script src="js/phaser.js"></script>
    <script src="js/objects.js"></script>
    <script src="js/triggers.js"></script>
    <script src="js/player.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/game.js"></script>    
    <script src="js/client.js"></script>
    <script src="js/attacks.js"></script>
    <script src="js/mobs.js"></script>
    <script src="js/objects/set1.js"></script>
    <script src="js/levels.js"></script>

    <script src="js/forms.js"></script>


    <script>
    var PLAYER_INDX;
    var PLAYER_NUM;
    var isConnected = false;
    var SERVER_STATE = {"data": { "players": [] }};
    var CLIENT = new Client();
    var REMOTE_EVENTS = [];
    var ws;

    var pieces = document.cookie.split(";");
    for(i in pieces) {
        if(pieces[i].indexOf("player") != -1) {
            PLAYER_NUM = pieces[i].split("=")[1];
            PLAYER_INDX = PLAYER_NUM - 1;
        }
    }

    if(PLAYER_INDX == undefined) {
        PLAYER_INDX = 1;
        PLAYER_NUM = 2;
        CURRENT_PLAYER_INDEX = PLAYER_INDX;
    }

    function updatePosition(x, y) {
        CLIENT.send(JSON.stringify({"action": "updatePlayerPosition", "x": x, "y": y}))
    }

    var com_update = function () {
        var requests = [];
        if(isConnected && CURRENT_PLAYER) {
            CLIENT.queueRequest({
                "action": "updatePlayer",
                "player": {
                    "position": [CURRENT_PLAYER.x, CURRENT_PLAYER.y],
                    "velocity": [CURRENT_PLAYER.body.velocity.x, CURRENT_PLAYER.body.velocity.y],
                    "facing": CURRENT_PLAYER.body.facing
                }
            });

            //ws.send(request);
            CLIENT.sendQueueMessages();
        }
    }
    </script>
</head>
<body>
    <div id="loginModal" class="reveal-modal remove-whitespace" data-reveal  data-options="close_on_background_click:false">
        <div class="row">
            <div class="large-6 columns auth-plain">
                <div class="signup-panel left-solid">
                    <p class="welcome">Log In</p>
                    <form id="login-form">
                        <div class="row collapse">
                            <div class="small-12  columns">
                                <input type="text" name="username" placeholder="username">
                            </div>
                        </div>
                        <div class="row collapse">
                            <div class="small-12 columns ">
                                <input type="password" name="password" placeholder="password">
                            </div>
                        </div>
                    </form>
                    <ul class="small-block-grid-2">
                        <li><a href="#" id="login-btn" class="button">Log In </a></li>
                        <li><a href="#" data-reveal-id="registerModal" class="button secondary register">Register</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <a class="close-reveal-modal">&#215;</a>
    </div>

    <div id="registerModal" class="reveal-modal remove-whitespace" data-reveal data-options="close_on_background_click:false">
        <div class="row">
            <div class="large-6 columns auth-plain">
                <div class="signup-panel left-solid">
                    <p class="welcome">Register</p>
                    <form id="registration-form">
                        <div class="row collapse">
                            <div class="small-12  columns">
                                <input type="text" name="username" placeholder="username">
                            </div>
                        </div>
                        <div class="row collapse">
                            <div class="small-12 columns ">
                                <input type="password" name="password" placeholder="password">
                            </div>
                        </div>
                    </form>
                    <ul class="small-block-grid-2">
                        <li><a href="#" id="register-btn" class="button">Register</a></li>
                        <li><a href="#" data-reveal-id="loginModal"  class="button secondary log-in">Log In </a></li>
                    </ul>
                </div>
            </div>
        </div>
        <a class="close-reveal-modal">&#215;</a>
    </div>

    <div id="gamesModal" class="reveal-modal remove-whitespace" data-reveal data-options="close_on_background_click:false">
        <div class="row">
            <div class="large-6 columns auth-plain">
                <div class="signup-panel left-solid">
                    <p class="welcome">Choose a Game</p>
                    <ul class="no-bullet" id="game-list"></ul>
                    <a href="#" onClick="initGame(null)">New Game</a>
                </div>
            </div>
        </div>
        <a class="close-reveal-modal">&#215;</a>
    </div>
    <script>
        $(document).foundation();
    </script>
</body>
</html>